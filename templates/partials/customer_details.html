<div class="space-y-4">
    <!-- Header -->
    <div class="flex items-start justify-between">
        <div>
            <h3 class="text-lg font-semibold">{{ customer.name }}</h3>
            <p class="text-sm text-muted">{{ customer.city }}</p>
        </div>
        <a
            href="/customers/{{ customer.id }}"
            class="text-xs text-brand hover:underline transition"
        >
            Full Profile ‚Üí
        </a>
    </div>

    <!-- Contact Info -->
    <div class="py-3 border-t border-border space-y-3">
        {% if customer.address %}
        <div>
            <div class="text-xs text-muted mb-1">Address</div>
            <div class="text-sm flex items-start justify-between gap-2">
                <span class="flex-1">{{ customer.address }}</span>
                <a
                    href="https://maps.google.com/?q={{ customer.address|urlencode }}"
                    target="_blank"
                    class="text-brand hover:underline text-xs whitespace-nowrap flex items-center gap-1"
                >
                    <svg
                        class="w-3 h-3"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"
                        />
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"
                        />
                    </svg>
                    Navigate
                </a>
            </div>
        </div>
        {% else %}
        <div>
            <div class="text-xs text-muted mb-1">Address</div>
            <div class="text-sm text-muted">Not provided</div>
        </div>
        {% endif %} {% if customer.phone %}
        <div>
            <div class="text-xs text-muted mb-1">Phone</div>
            <div class="text-sm flex items-center justify-between">
                <span>{{ customer.phone }}</span>
                <a
                    href="tel:{{ customer.phone }}"
                    class="text-brand hover:underline text-xs flex items-center gap-1"
                >
                    <svg
                        class="w-3 h-3"
                        fill="none"
                        stroke="currentColor"
                        viewBox="0 0 24 24"
                    >
                        <path
                            stroke-linecap="round"
                            stroke-linejoin="round"
                            stroke-width="2"
                            d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"
                        />
                    </svg>
                    Call
                </a>
            </div>
        </div>
        {% else %}
        <div>
            <div class="text-xs text-muted mb-1">Phone</div>
            <div class="text-sm text-muted">Not provided</div>
        </div>
        {% endif %}
    </div>

    <!-- Balance -->
    <div class="py-3 border-t border-border">
        <div class="text-xs text-muted mb-1">Current Balance</div>
        <div
            class="text-3xl font-semibold {% if customer.balance > 0 %}text-warn{% else %}text-good{% endif %}"
        >
            ${{ "%.2f"|format(customer.balance) }}
        </div>
        {% if customer.balance > 0 %}
        <div class="text-xs text-warn mt-1">‚ö† Outstanding payment</div>
        {% else %}
        <div class="text-xs text-good mt-1">‚úì Paid in full</div>
        {% endif %}
    </div>

    <!-- Visit History -->
    <div class="py-3 border-t border-border">
        <div class="text-xs text-muted mb-2">Visit History</div>

        {% if customer.last_visit %}
        <div class="space-y-2">
            <div
                class="flex items-center justify-between text-sm bg-panel2 p-2 rounded"
            >
                <span>Last visit</span>
                <span class="font-semibold"
                    >{{ customer.last_visit.strftime('%b %d, %Y') }}</span
                >
            </div>
            {% set days_ago = (now - customer.last_visit).days %}
            <div class="text-xs text-muted">
                {{ days_ago }} day{% if days_ago != 1 %}s{% endif %} ago {% if
                days_ago > 60 %}
                <span class="text-danger font-semibold">- Overdue!</span>
                {% elif days_ago > 30 %}
                <span class="text-warn font-semibold">- Due soon</span>
                {% endif %}
            </div>
        </div>
        {% else %}
        <div class="text-sm bg-danger/10 text-danger p-2 rounded">
            Never visited - Schedule first visit!
        </div>
        {% endif %}
    </div>

    <!-- Recent Stops -->
    {% if customer.stops %}
    <div class="py-3 border-t border-border">
        <div class="text-xs text-muted mb-2">
            Recent Stops ({{ customer.stops|length }} total)
        </div>
        <div class="space-y-1 max-h-32 overflow-y-auto">
            {% for stop in customer.stops[-5:]|reverse %}
            <div
                class="flex items-center justify-between text-xs bg-panel2 p-2 rounded"
            >
                <span>{{ stop.route_date.strftime('%b %d, %Y') }}</span>
                {% if stop.completed %}
                <span class="text-good">‚úì Completed</span>
                {% else %}
                <span class="text-muted">Pending</span>
                {% endif %}
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Notes -->
    {% if customer.notes %}
    <div class="py-3 border-t border-border">
        <div class="text-xs text-muted mb-2">Notes</div>
        <div class="text-sm bg-panel2 p-3 rounded">{{ customer.notes }}</div>
    </div>
    {% endif %}

    <!-- Payment History -->
    {% if customer.payments %}
    <div class="py-3 border-t border-border">
        <div class="text-xs text-muted mb-2">
            Recent Payments ({{ customer.payments|length }} total)
        </div>
        <div class="space-y-1 max-h-32 overflow-y-auto">
            {% for payment in customer.payments[-5:]|reverse %}
            <div
                class="flex items-center justify-between text-xs bg-panel2 p-2 rounded"
            >
                <span>{{ payment.payment_date.strftime('%b %d, %Y') }}</span>
                <span class="font-semibold text-good"
                    >${{ "%.2f"|format(payment.amount) }}</span
                >
            </div>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Actions -->
    <div class="pt-3 border-t border-border space-y-2">
        <a
            href="/planner"
            class="w-full bg-brand hover:bg-blue-700 text-white text-sm font-semibold px-4 py-3 rounded-md transition flex items-center justify-center gap-2"
        >
            <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
            >
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 4v16m8-8H4"
                />
            </svg>
            Schedule Visit
        </a>

        {% if customer.balance > 0 %}
        <a
            href="/customers/{{ customer.id }}"
            class="w-full bg-good hover:bg-green-600 text-white text-sm font-semibold px-4 py-3 rounded-md transition flex items-center justify-center gap-2"
        >
            <svg
                class="w-4 h-4"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
            >
                <path
                    stroke-linecap="round"
                    stroke-linejoin="round"
                    stroke-width="2"
                    d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
                />
            </svg>
            Record Payment (${{ "%.2f"|format(customer.balance) }})
        </a>
        {% endif %}

        <div class="grid grid-cols-2 gap-2">
            {% if customer.phone %}
            <a
                href="tel:{{ customer.phone }}"
                class="bg-panel2 hover:bg-border text-white text-center text-xs font-semibold px-4 py-2 rounded-md transition"
            >
                üìû Call
            </a>
            {% endif %} {% if customer.address %}
            <a
                href="https://maps.google.com/?q={{ customer.address|urlencode }}"
                target="_blank"
                class="bg-panel2 hover:bg-border text-white text-center text-xs font-semibold px-4 py-2 rounded-md transition"
            >
                üó∫Ô∏è Navigate
            </a>
            {% endif %}
        </div>
    </div>
</div>
