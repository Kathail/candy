<div class="space-y-4">
    <!-- Header -->
    <div class="flex items-start justify-between">
        <div>
            <h3 class="text-lg font-semibold">{{ stop.customer.name }}</h3>
            <p class="text-sm text-muted">{{ stop.customer.city }}</p>
        </div>
        {% if stop.completed %}
        <span
            class="flex items-center gap-1 text-good text-xs font-semibold bg-good/10 px-2 py-1 rounded"
        >
            <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                <path
                    fill-rule="evenodd"
                    d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                    clip-rule="evenodd"
                />
            </svg>
            Completed
        </span>
        {% else %}
        <span
            class="text-xs font-semibold bg-warn/20 text-warn px-2 py-1 rounded"
            >Pending</span
        >
        {% endif %}
    </div>

    <!-- Contact Info -->
    <div class="py-3 border-t border-border space-y-2">
        {% if stop.customer.address %}
        <div>
            <div class="text-xs text-muted mb-1">Address</div>
            <div class="text-sm flex items-center justify-between">
                <span>{{ stop.customer.address }}</span>
                <a
                    href="https://maps.google.com/?q={{ stop.customer.address|urlencode }}"
                    target="_blank"
                    class="text-brand hover:underline text-xs"
                >
                    Navigate →
                </a>
            </div>
        </div>
        {% endif %} {% if stop.customer.phone %}
        <div>
            <div class="text-xs text-muted mb-1">Phone</div>
            <div class="text-sm flex items-center justify-between">
                <span>{{ stop.customer.phone }}</span>
                <a
                    href="tel:{{ stop.customer.phone }}"
                    class="text-brand hover:underline text-xs"
                >
                    Call →
                </a>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Balance -->
    <div class="py-3 border-t border-border">
        <div class="text-xs text-muted mb-1">Customer Balance</div>
        <div
            class="text-2xl font-semibold {% if stop.customer.balance > 0 %}text-warn{% else %}text-good{% endif %}"
        >
            ${{ "%.2f"|format(stop.customer.balance) }}
        </div>
        {% if stop.customer.balance > 0 %}
        <div class="text-xs text-muted mt-1">Outstanding payment due</div>
        {% else %}
        <div class="text-xs text-good mt-1">✓ Paid in full</div>
        {% endif %}
    </div>

    <!-- Last Visit -->
    <div class="py-3 border-t border-border">
        <div class="text-xs text-muted mb-1">Last Visit</div>
        <div class="text-sm">
            {% if stop.customer.last_visit %} {{
            stop.customer.last_visit.strftime('%B %d, %Y') }}
            <span class="text-xs text-muted">
                ({{ (stop.route_date - stop.customer.last_visit).days }} days
                ago)
            </span>
            {% else %}
            <span class="text-warn">First time visit</span>
            {% endif %}
        </div>
    </div>

    <!-- Notes -->
    {% if stop.notes or stop.customer.notes %}
    <div class="py-3 border-t border-border">
        <div class="text-xs text-muted mb-2">Notes</div>
        {% if stop.notes %}
        <div class="text-sm bg-panel2 p-2 rounded mb-2">
            <div class="text-xs text-muted mb-1">Stop Notes:</div>
            {{ stop.notes }}
        </div>
        {% endif %} {% if stop.customer.notes %}
        <div class="text-sm bg-panel2 p-2 rounded">
            <div class="text-xs text-muted mb-1">Customer Notes:</div>
            {{ stop.customer.notes }}
        </div>
        {% endif %}
    </div>
    {% endif %}

    <!-- Actions -->
    <div class="pt-3 border-t border-border space-y-2">
        {% if not stop.completed %}
        <button
            hx-post="/route/stop/{{ stop.id }}/complete"
            hx-target="#stop-details"
            hx-swap="innerHTML"
            class="w-full bg-good hover:bg-green-600 text-white text-sm font-semibold px-4 py-3 rounded-md transition flex items-center justify-center gap-2"
        >
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path
                    fill-rule="evenodd"
                    d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z"
                    clip-rule="evenodd"
                />
            </svg>
            Mark as Complete
        </button>
        {% else %}
        <button
            hx-post="/route/stop/{{ stop.id }}/uncomplete"
            hx-target="#stop-details"
            hx-swap="innerHTML"
            class="w-full bg-panel2 hover:bg-border text-white text-sm font-semibold px-4 py-3 rounded-md transition"
        >
            Undo Complete
        </button>
        {% endif %} {% if stop.customer.balance > 0 %}
        <button
            onclick="alert('Payment recording feature coming soon!')"
            class="w-full bg-brand hover:bg-blue-700 text-white text-sm font-semibold px-4 py-3 rounded-md transition"
        >
            Record Payment
        </button>
        {% endif %}

        <a
            href="/customers/{{ stop.customer.id }}"
            class="block w-full bg-panel2 hover:bg-border text-white text-center text-sm font-semibold px-4 py-3 rounded-md transition"
        >
            View Full Customer Profile
        </a>
    </div>
</div>
